# 苍穹织网 - 城市低空物流数据获取与处理详细规划

本项目强调“真实数据”作为核心亮点（降维打击伪造数据的项目），因此在前期数据获取与清洗阶段需做到来源可靠、粒度合适、格式统一。为保证比赛答辩的稳定性及开发效率，建议将展示区域**限定在某典型高科技城市的一个核心区块**（例如：深圳市南山区粤海街道，面积约 10-15 平方公里）。

以下是三大核心数据底座的详细获取与处理规划：

---

## 一、 真实无人机物流轨迹数据集 (UAV Trajectory)

**目标**：获取含有经纬度、高度、时间戳、三轴或姿态数据的真实无人机飞行日志。
**挑战**：纯商业外卖无人机轨迹极少公开；需要使用科研类无人机飞行数据集替代或拼接。

### 1. 数据获取渠道
*   **首选：学术界公开数据集**
    *   **Zenodo / IEEE Dataport**：搜索关键词 `"UAV trajectory dataset"`, `"drone flight log"`, `"delivery drone dataset"`。
    *   *具体推荐*：苏黎世联邦理工学院(ETH)或国内如北航、大疆等公开的视觉/导航无人机测试数据集（如 EuRoC MAV Dataset 或 ALIEN 数据集）。
*   **备选：开源飞控社区日志**
    *   **PX4 Flight Review** / **ArduPilot**：这些开源固件社区有大量真实玩家/开发者上传的实飞日志（`.ulog` 或 `DataFlash` 格式）。可以筛选在城市环境中飞行的多旋翼无人机日志。

### 2. 获取与处理步骤
1.  **下载与解析**：将原始格式（ulog/bag 等）利用开源脚本转换为易读的 `CSV` 格式。
2.  **数据清洗与特征提取 (Python / Pandas)**：
    *   **提取核心字段**：只保留 `timestamp`, `lat` (纬度), `lon` (经度), `alt` (海拔/相对高度), `yaw/pitch/roll` (姿态角), `velocity` (速度), `battery_remaining` (电量)。
    *   **降采样处理**：原始传感器数据可能高达 100Hz，不利于前端渲染。按需降采样至 1Hz 或 5Hz。
3.  **轨迹重规划（场景适配）**：将获取的各地区独立飞行轨迹，通过“平移”操作，整体映射到我们选定的演示区域（如深圳南山区），虚构多个编队的物流配送并发场景，但保证**每一条单轨迹的物理动力学特征是绝对真实**的。

---

## 二、 三维城市地理与设施数据 (3D Urban Geo & POI)

**目标**：构建用于航线碰撞检测的3D建筑实体盲区，以及用于受限区与选址分析的 POI（敏感点+需求点）数据。

### 1. 建筑轮廓与高度数据 (Building Footprints)
*   **获取渠道**：
    *   **OpenStreetMap (OSM)**：免费开源，结构化好。
    *   **工具**：使用 Python 的 `OSMnx` 库，或者在网页端用 `Overpass Turbo` 导出。
*   **获取步骤**：
    1.  确定边界框 (Bounding Box): 选择例如 `[113.93, 22.52, 113.96, 22.55]` 这块区域。
    2.  利用 `OSMnx` 提取包含 `building=yes` 标签的多边形 (Polygon)。
    3.  **高度补全**：国内 OSM 的建筑高度（`levels` 或 `height` 字段）往往缺失。应对策略：
        *   对未标注高度的建筑设定一个按区域性质分布的随机高度。
        *   或者利用开发者账号，通过**高德/百度地图 API**，爬取补充局部地标建筑的真实高度。
    4.  输出为 `buildings.geojson`。

### 2. 兴趣点数据 (POI: 学校、医院、写字楼、小区)
*   **获取渠道**：高德地图 Web 开放 API （申请个人开发者，免费额度足够） / 百度地图 API。
*   **获取步骤**：
    1.  注册获取 API Key。
    2.  编写 Python 脚本，调用 POI 周边搜索或多边形搜索接口。
    3.  **敏感点抓取**：搜索 `分类=医院|学校|党政机关`，获取坐标后，在 GeoPandas 中做 100 米 Buffer，形成“动态禁飞圆区”。
    4.  **需求点抓取**：搜索 `分类=写字楼|住宅小区`，获取坐标及热度，作为第三模块“基建选址优化”的输入热点。
    5.  输出为 `poi_sensitive.geojson` 和 `poi_demand.geojson`。

---

## 三、 微气象历史风场数据 (Micro-meteorological Data)

**目标**：叠加天气影响，展示气象约束下的航线安全性（生成风险热力图）。

### 1. 数据获取渠道
*   **首选渠道：QWeather (和风天气 API) / OpenWeather**
    *   两者均提供历史气象数据查询的开发者免费额度。
*   **硬核科研渠道**：ECMWF ERA5-Land (第五代陆地气候再分析数据集)
    *   绝对真实的高维气象库，可通过 Copernicus CDS API 免费下载 NetCDF (nc) 格式数据。

### 2. 获取与虚拟演化步骤
真实城市内部几百米级别的精细化风场数据通常是机密数据。我们在比赛中可采取以下策略保障逻辑严密：
1.  **获取宏观背景气象**：通过 API 拉取所选区域某历史大风日（如某台风天过境期间）逐小时的“风向、阵风风力”。
2.  **城市峡谷效应推演 (数学建模)**：
    *   将 3D 物联网底座网格化（如 100m x 100m）。
    *   编写算法：当宏观风向与密集高层双排楼宇平行时，由于**狭管效应**，该网格的实际风力放大 1.5 倍；在建筑背风面，风力削弱但增加扰动风险。
3.  **产出风险矩阵**：通过上述模型，产出该气象条件下的网格化安全性指数，输出为 `wind_risk_grid.json`，供前端渲染红色高亮危险网格（热力图）。

---

## 四、 总体工程实施路径与数据存储建议

### 1. 实施时间线建议
*   **Day 1-2**: 跑通 OSM 建筑数据与高德 POI 取数据脚本，筛选定局展示用的一块城市区域，输出完备的 GeoJSON，交付给前端做 Deck.gl 渲染测试。
*   **Day 3-4**: 啃下无人机飞行日志。使用 `Pandas` 完成清洗、坐标系转换与平移。将真实轨迹动画投射到上述构建的三维城市中。
*   **Day 5**: 利用拉取的气象数据叠加建筑模型，生成气象风险层数据；利用 POI 需求点数据，运行 K-Means 或 DBSCAN 聚类算法求取起降基站（Vertiport）最优位置。

### 2. 后端数据流向与存储 (实战避坑)
*   为了防止答辩现场演示时的网络卡顿与三方接口限制，**完全摒弃实时请求**。
*   前期利用 Python 脚本走批处理流程，将所有外部数据全部沉淀为本地清洗过的标准化 JSON/CSV。
*   **轻量化部署**：后端避免部署笨重的关系型数据库。建议使用 `SQLite` 或 **`DuckDB`** (极力推荐，适合分析型快速查询) 将数据整体打包，或者后端启动时直接将静态文件加载进内存，以确保前端查询时得到极其丝滑（<50ms）的响应体验，这在比赛答辩中具有决定性优势。

---
这份数据规划明确了数据的*什么（是什么）*、*哪里（哪里找）*、以及*如何（如何变成我们的弹药）*。您可以先浏览一下，确认获取的难度和重点方向。确认后我们可以立即开始编写第一部分（如抓取地理建筑与 POI 数据）的实施脚本。
